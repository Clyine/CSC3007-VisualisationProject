<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jingquan Chen, John Wang, Keng Li Chia, Jourdan Lim, Perpetua Raj, Joey Tan">

<title>Vizualizing Crude Oil Analysis: World car production grows 3 times faster than global oil supplies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="data_preprocess_files/libs/clipboard/clipboard.min.js"></script>
<script src="data_preprocess_files/libs/quarto-html/quarto.js"></script>
<script src="data_preprocess_files/libs/quarto-html/popper.min.js"></script>
<script src="data_preprocess_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="data_preprocess_files/libs/quarto-html/anchor.min.js"></script>
<link href="data_preprocess_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data_preprocess_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="data_preprocess_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="data_preprocess_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="data_preprocess_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Vizualizing Crude Oil Analysis: World car production grows 3 times faster than global oil supplies</h1>
<p class="subtitle lead">Data Preparation</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jingquan Chen, John Wang, Keng Li Chia, Jourdan Lim, Perpetua Raj, Joey Tan </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document contains the data engineering required to reconstruct and improve the plot by <span class="citation" data-cites="Matt">@Matt</span>, shown in <a href="#fig-1" class="quarto-xref">Figure&nbsp;1</a>, depicting the world car production growth compared to global oil supplies of various countries from the year 1999 to 2012.</p>
<p>The codes below requires the following packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/original-graph.png" class="img-fluid figure-img" width="421">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Visualization of world car production growth compared to global oil supplies from 1999 to 2012 by <span class="citation" data-cites="Matt">@Matt</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="visualization-source" class="level2">
<h2 class="anchored" data-anchor-id="visualization-source">Visualization Source</h2>
<ul>
<li><a href="https://crudeoilpeak.info/world-car-production-grows-3-times-faster-than-global-oil-supplies">Crude Oil Peak</a></li>
</ul>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<ul>
<li><a href="https://www.oica.net/category/production-statistics/">Cars Production Statistics</a>
<ul>
<li>Created CSV from tables data</li>
</ul></li>
<li><a href="https://www.eia.gov/international/data/world/petroleum-and-other-liquids/annual-petroleum-and-other-liquids-production?pd=5&amp;p=0000000000000000000000000000000000vg&amp;u=0&amp;f=A&amp;v=mapbubble&amp;a=-&amp;i=none&amp;vo=value&amp;&amp;t=C&amp;g=00000000000000000000000000000000000000000000000001&amp;l=249-ruvvvvvfvtvnvv1vrvvvvfvvvvvvfvvvou20evvvvvvvvvvnvvvs0008&amp;s=94694400000&amp;e=1704067200000">Petroleum and Other Liquids: Annual Petroleum and Other Liquids Production</a>
<ul>
<li>Deleted Column 1 (API)</li>
</ul></li>
</ul>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cars_raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"cars_data.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>oil_raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"oil_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preview-raw-data" class="level2">
<h2 class="anchored" data-anchor-id="preview-raw-data">Preview Raw Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cars_raw <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country.Region       Cars Commercial.Vehicles      Total Change Year
1      ARGENTINA    304 783             305 942    610 725    14% 2023
2        AUSTRIA    102 291              11 900    114 191    -6% 2023
3        BELGIUM    285 159              46 944    332 103    16% 2023
4         BRAZIL  1 781 612             543 226  2 324 838    -2% 2023
5         CANADA    376 888           1 176 138  1 553 026    26% 2023
6          CHINA 26 123 757           4 037 209 30 160 966    12% 2023</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>oil_raw <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                            X     X1973
1                                                       World          
2                                                  Production          
3                    Total petroleum and other liquids (Mb/d)          
4                   Crude oil, NGPL, and other liquids (Mb/d)          
5                 Crude oil including lease condensate (Mb/d) 50359.734
6                                                 NGPL (Mb/d)          
      X1974     X1975     X1976     X1977    X1978     X1979       X1980
1                                                                       
2                                                                       
3                                                                63987.8
4                                                                63092.9
5 50376.905 47570.995 51743.766 53881.362 54259.53 56617.534 59557.68724
6                                                             3446.28975
        X1981       X1982       X1983       X1984       X1985       X1986
1                                                                        
2                                                                        
3       60602     58100.1     57929.3 59563.45794 59156.12543 61534.95768
4     59785.5     57242.9     57123.7     58613.7     58186.9   60769.573
5 55899.59203 53453.19682 53249.76199 54498.53904 53965.43472 56326.14124
6     3630.69      3631.8      3643.3      3872.7        3933      4162.9
        X1987       X1988       X1989       X1990       X1991       X1992
1                                                                        
2                                                                        
3 62101.27044 64398.73171 65524.91126 66437.18391  66338.8511 66551.97017
4   61257.573   63496.754   64633.954   65482.054   65316.436   65405.968
5 56649.39526 58696.60209 59802.71265  60497.9124 60128.17914  60100.6977
6      4284.5      4498.4      4512.4      4644.9    4816.557   4847.6127
      X1993     X1994     X1995    X1996     X1997     X1998    X1999    X2000
1        NA        NA        NA       NA        NA        NA       NA       NA
2        NA        NA        NA       NA        NA        NA       NA       NA
3 66337.046 68404.809 69738.199 71406.80 73756.479 74754.927 73443.89 75621.90
4 65570.717 67636.848 68963.812 70569.74 72907.076 73868.781 72557.51 74673.98
5 58754.468 60577.428 61568.594 62841.40 65001.265 65921.770 64359.99 66358.85
6  6113.332  6221.953  6457.515  6759.09  6886.418  6894.876  7106.10  7196.93
      X2001     X2002     X2003       X2004       X2005       X2006       X2007
1        NA        NA        NA                                                
2        NA        NA        NA                                                
3 75764.242 75599.862 78497.801 83153.50174 84672.88548 85250.20133 85474.13004
4 74860.927 74643.300 77523.807 81014.48109 82560.42387 83095.31482 83321.14063
5 66326.615 65772.885 69257.731 72077.98249 74027.85679 74233.60125 74264.11817
6  7366.642  7562.909  6925.111 7349.254426  6909.86617 7028.920096 7042.141485
        X2008       X2009       X2010       X2011       X2012       X2013
1                                                                        
2                                                                        
3 86767.47017 85716.22519 87317.27823 88481.56412 90769.35776 91305.82012
4  84638.5113 83621.37244 85154.73524 86311.29113 88595.27057 89113.72874
5 74469.65227 73145.72246 74407.78496 75084.26675 76683.47228 76767.80062
6 8191.988077  8350.34626 8050.647305  8358.17598 8870.611047 9031.474242
        X2014       X2015       X2016       X2017       X2018       X2019
1                                                                        
2                                                                        
3 93899.47441 96659.23578    97108.92 97786.58439 100415.8247 100161.5546
4 91671.57119 94383.14848 94826.63236  95452.9707 98047.28477 97814.97575
5 78611.90046 80965.42423 81022.57698 81202.78312 82930.42156  82123.8627
6 9544.027103  9887.71414 10184.70757 10605.95435 11197.55825 11713.79989
        X2020       X2021       X2022       X2023 X2024
1                                                    NA
2                                                    NA
3 93798.40647 95682.74081 100140.0895 101820.3917    NA
4 91691.19374 93419.87336 97830.65042 99486.53155    NA
5 75986.44104 77177.04123 80820.48201 81795.75253    NA
6 11913.23885  12270.0754  12826.3136 13181.20149    NA</code></pre>
</div>
</div>
</section>
</section>
<section id="data-cleaning-preprocessing" class="level1">
<h1>Data Cleaning &amp; Preprocessing</h1>
<section id="preprocess-oil-data" class="level2">
<h2 class="anchored" data-anchor-id="preprocess-oil-data">Preprocess Oil Data</h2>
<section id="step-1-get-countries" class="level3">
<h3 class="anchored" data-anchor-id="step-1-get-countries">Step 1: Get Countries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequence of row indices in multiplies of 8 to get countries (1, 9, 17, ..., 1849)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>countries_indices <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(oil_raw), <span class="at">by =</span> <span class="dv">8</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 8th row</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>countries_selected <span class="ot">&lt;-</span> oil_raw[countries_indices, ]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the first column</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>countries_oil <span class="ot">&lt;-</span> countries_selected[, <span class="dv">1</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display countries</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(countries_oil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "World"                        "Afghanistan"                 
  [3] "Albania"                      "Algeria"                     
  [5] "American Samoa"               "Angola"                      
  [7] "Antarctica"                   "Antigua and Barbuda"         
  [9] "Argentina"                    "Armenia"                     
 [11] "Aruba"                        "Australia"                   
 [13] "Austria"                      "Azerbaijan"                  
 [15] "Bahrain"                      "Bangladesh"                  
 [17] "Barbados"                     "Belarus"                     
 [19] "Belgium"                      "Belize"                      
 [21] "Benin"                        "Bermuda"                     
 [23] "Bhutan"                       "Bolivia"                     
 [25] "Bosnia and Herzegovina"       "Botswana"                    
 [27] "Brazil"                       "British Virgin Islands"      
 [29] "Brunei"                       "Bulgaria"                    
 [31] "Burkina Faso"                 "Burma"                       
 [33] "Burundi"                      "Cabo Verde"                  
 [35] "Cambodia"                     "Cameroon"                    
 [37] "Canada"                       "Cayman Islands"              
 [39] "Central African Republic"     "Chad"                        
 [41] "Chile"                        "China"                       
 [43] "Colombia"                     "Comoros"                     
 [45] "Congo-Brazzaville"            "Congo-Kinshasa"              
 [47] "Cook Islands"                 "Costa Rica"                  
 [49] "Cote d'Ivoire"                "Croatia"                     
 [51] "Cuba"                         "Cyprus"                      
 [53] "Czechia"                      "Denmark"                     
 [55] "Djibouti"                     "Dominica"                    
 [57] "Dominican Republic"           "Ecuador"                     
 [59] "Egypt"                        "El Salvador"                 
 [61] "Equatorial Guinea"            "Eritrea"                     
 [63] "Estonia"                      "Eswatini"                    
 [65] "Ethiopia"                     "Falkland Islands"            
 [67] "Faroe Islands"                "Fiji"                        
 [69] "Finland"                      "Former Czechoslovakia"       
 [71] "Former Serbia and Montenegro" "Former U.S.S.R."             
 [73] "Former Yugoslavia"            "France"                      
 [75] "French Guiana"                "French Polynesia"            
 [77] "Gabon"                        "Gambia, The"                 
 [79] "Georgia"                      "Germany"                     
 [81] "Germany, East"                "Germany, West"               
 [83] "Ghana"                        "Gibraltar"                   
 [85] "Greece"                       "Greenland"                   
 [87] "Grenada"                      "Guadeloupe"                  
 [89] "Guam"                         "Guatemala"                   
 [91] "Guinea"                       "Guinea-Bissau"               
 [93] "Guyana"                       "Haiti"                       
 [95] "Hawaiian Trade Zone"          "Honduras"                    
 [97] "Hong Kong"                    "Hungary"                     
 [99] "Iceland"                      "India"                       
[101] "Indonesia"                    "Iran"                        
[103] "Iraq"                         "Ireland"                     
[105] "Israel"                       "Italy"                       
[107] "Jamaica"                      "Japan"                       
[109] "Jordan"                       "Kazakhstan"                  
[111] "Kenya"                        "Kiribati"                    
[113] "Kosovo"                       "Kuwait"                      
[115] "Kyrgyzstan"                   "Laos"                        
[117] "Latvia"                       "Lebanon"                     
[119] "Lesotho"                      "Liberia"                     
[121] "Libya"                        "Lithuania"                   
[123] "Luxembourg"                   "Macau"                       
[125] "Madagascar"                   "Malawi"                      
[127] "Malaysia"                     "Maldives"                    
[129] "Mali"                         "Malta"                       
[131] "Martinique"                   "Mauritania"                  
[133] "Mauritius"                    "Mexico"                      
[135] "Micronesia"                   "Moldova"                     
[137] "Mongolia"                     "Montenegro"                  
[139] "Montserrat"                   "Morocco"                     
[141] "Mozambique"                   "Namibia"                     
[143] "Nauru"                        "Nepal"                       
[145] "Netherlands"                  "Netherlands Antilles"        
[147] "New Caledonia"                "New Zealand"                 
[149] "Nicaragua"                    "Niger"                       
[151] "Nigeria"                      "Niue"                        
[153] "North Korea"                  "North Macedonia"             
[155] "Northern Mariana Islands"     "Norway"                      
[157] "Oman"                         "Pakistan"                    
[159] "Palestinian Territories"      "Panama"                      
[161] "Papua New Guinea"             "Paraguay"                    
[163] "Peru"                         "Philippines"                 
[165] "Poland"                       "Portugal"                    
[167] "Puerto Rico"                  "Qatar"                       
[169] "Reunion"                      "Romania"                     
[171] "Russia"                       "Rwanda"                      
[173] "Saint Helena"                 "Saint Kitts and Nevis"       
[175] "Saint Lucia"                  "Saint Pierre and Miquelon"   
[177] "Saint Vincent/Grenadines"     "Samoa"                       
[179] "Sao Tome and Principe"        "Saudi Arabia"                
[181] "Senegal"                      "Serbia"                      
[183] "Seychelles"                   "Sierra Leone"                
[185] "Singapore"                    "Slovakia"                    
[187] "Slovenia"                     "Solomon Islands"             
[189] "Somalia"                      "South Africa"                
[191] "South Korea"                  "South Sudan"                 
[193] "Spain"                        "Sri Lanka"                   
[195] "Sudan"                        "Suriname"                    
[197] "Sweden"                       "Switzerland"                 
[199] "Syria"                        "Taiwan"                      
[201] "Tajikistan"                   "Tanzania"                    
[203] "Thailand"                     "The Bahamas"                 
[205] "Timor-Leste"                  "Togo"                        
[207] "Tonga"                        "Trinidad and Tobago"         
[209] "Tunisia"                      "Turkiye"                     
[211] "Turkmenistan"                 "Turks and Caicos Islands"    
[213] "Tuvalu"                       "U.S. Pacific Islands"        
[215] "U.S. Territories"             "U.S. Virgin Islands"         
[217] "Uganda"                       "Ukraine"                     
[219] "United Arab Emirates"         "United Kingdom"              
[221] "United States"                "Uruguay"                     
[223] "Uzbekistan"                   "Vanuatu"                     
[225] "Venezuela"                    "Vietnam"                     
[227] "Wake Island"                  "Western Sahara"              
[229] "Yemen"                        "Zambia"                      
[231] "Zimbabwe"                    </code></pre>
</div>
</div>
</section>
<section id="step-2-get-years" class="level3">
<h3 class="anchored" data-anchor-id="step-2-get-years">Step 2: Get Years</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all the column names, for years</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>years_selected <span class="ot">&lt;-</span> <span class="fu">colnames</span>(oil_raw)[<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(oil_raw)]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "X" and convert to numeric</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>years_oil <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"X"</span>, <span class="st">""</span>, years_selected))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display years</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(years_oil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987
[16] 1988 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002
[31] 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017
[46] 2018 2019 2020 2021 2022 2023 2024</code></pre>
</div>
</div>
</section>
<section id="step-3-get-petroleum-data-from-total-petroleum-and-other-liquids-mbd-column" class="level3">
<h3 class="anchored" data-anchor-id="step-3-get-petroleum-data-from-total-petroleum-and-other-liquids-mbd-column">Step 3: Get Petroleum Data from “Total petroleum and other liquids (Mb/d)” Column</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create indices</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>total_petroleum_indices <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">3</span>, <span class="fu">nrow</span>(oil_raw), <span class="at">by =</span> <span class="dv">8</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>petroleum_selected <span class="ot">&lt;-</span> oil_raw[total_petroleum_indices, ]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display petrolum data head() </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(petroleum_selected))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                  X      X1973       X1974
3          Total petroleum and other liquids (Mb/d)                       
11         Total petroleum and other liquids (Mb/d)                       
19         Total petroleum and other liquids (Mb/d)                       
27         Total petroleum and other liquids (Mb/d) 1096.90137 1008.860274
35         Total petroleum and other liquids (Mb/d)                       
43         Total petroleum and other liquids (Mb/d)        162         169
         X1975       X1976       X1977       X1978       X1979       X1980
3                                                                  63987.8
11                                                                       0
19                                                                      44
27 982.9972603 1075.259563 1151.849315 1231.052055 1224.167123 1105.907104
35                                                                       0
43         165         108         194         131         147         150
         X1981      X1982       X1983       X1984       X1985       X1986
3        60602    58100.1     57929.3 59563.45794 59156.12543 61534.95768
11           0          0           0           0           0           0
19          44         64          75          55          55          55
27 1002.032877 986.630137  961.260274 1014.440325 1036.071233        1072
35           0          0           0           0           0           0
43         130        122 177.0054795 208.0245902 231.0000795 282.0002986
         X1987       X1988       X1989       X1990       X1991       X1992
3  62101.27044 64398.73171 65524.91126 66437.18391  66338.8511 66551.97017
11           0           0           0           0           0           0
19          54          44          47          30          19          10
27 1071.320548        1045 1105.586301 1180.068493        1170 1201.612022
35           0           0           0           0           0           0
43 360.0001863 452.0081967 455.0003178 475.0005123 500.0002219 526.3200464
        X1993      X1994      X1995      X1996        X1997       X1998
3  66337.0462 68404.8092 69738.1987 71406.8033 73756.479140 74754.92657
11         NA         NA         NA         NA           NA          NA
19    11.0000    10.0000     9.0000     9.0000     7.150392     7.48989
27  1310.1644  1286.2877  1301.3699  1396.7350  1430.191781  1431.04110
35         NA         NA         NA         NA           NA          NA
43   503.9397   491.7589   639.3123   691.0164   709.786301   732.89863
         X1999     X2000      X2001      X2002      X2003       X2004
3  73443.88635 75621.903 75764.2419 75599.8619 78497.8013 83153.50174
11          NA        NA         NA         NA         NA           0
19     6.46023     5.716     5.6240     7.1060     6.7810        7.58
27  1376.95890  1435.587  1507.4795  1623.8356  1789.8904 1856.934792
35          NA        NA         NA         NA         NA           0
43   747.81342   745.388   739.2849   896.6363   879.0602 990.2883306
         X2005       X2006       X2007       X2008       X2009       X2010
3  84672.88548 85250.20133 85474.13004 86767.47017 85716.22519 87317.27823
11           0           0           0           0           0           0
19       6.985       9.072      10.082     6.03453 5.382407123 10.86676562
27 1930.027384 1917.468014 1942.263521    1954.481 1909.823112   1880.8924
35           0           0           0           0           0           0
43 1255.026608 1425.536786  1727.44877 1960.226508 1886.364219 1918.072548
         X2011       X2012       X2013       X2014       X2015       X2016
3  88481.56412 90769.35776 91305.82012 93899.47441 96659.23578    97108.92
11           0           0           0           0           0           0
19 15.56251849 16.84497057 17.01442118 20.56920932 20.21514384 22.80052388
27   1862.5645 1875.039769 1762.789322   1721.8256   1798.1049 1698.432256
35           0           0           0           0           0           0
43 1765.134438  1796.58018 1814.168534 1755.945438 1828.000014 1796.777754
         X2017       X2018       X2019       X2020       X2021       X2022
3  97786.58439 100415.8247 100161.5546 93798.40647 95682.74081 100140.0895
11           0           0           0           0           0           0
19    17.05404    16.05469    18.05546 17.31385896 16.15055317 15.05975827
27 1632.869525 1576.786934 1570.104304 1404.306744 1415.129339 1473.030681
35           0           0           0           0           0           0
43 1708.354531 1637.116441 1488.932374  1284.13903 1150.417404 1185.254399
         X2023 X2024
3  101820.3917    NA
11           0    NA
19 14.04472675    NA
27 1444.291046    NA
35           0    NA
43 1174.422203    NA</code></pre>
</div>
</div>
</section>
<section id="step-4-create-new-dataframe-with-countries-years-and-total-petroleum-and-other-liquids" class="level3">
<h3 class="anchored" data-anchor-id="step-4-create-new-dataframe-with-countries-years-and-total-petroleum-and-other-liquids">Step 4: Create new dataframe with Countries, Years, and Total Petroleum and Other Liquids</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new dataframe</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>new_oil_df <span class="ot">&lt;-</span> petroleum_selected</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace first column with countries</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>new_oil_df[, <span class="dv">1</span>] <span class="ot">&lt;-</span> countries_oil</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace column names with numeric years</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(new_oil_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Country"</span>, years_oil)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns to convert to numeric</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>columns_to_convert <span class="ot">&lt;-</span> <span class="fu">names</span>(new_oil_df)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns to numeric, ignoring NA values</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(new_oil_df[, columns_to_convert] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(new_oil_df[, columns_to_convert], as.numeric))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert first row country names to all upper case</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>new_oil_df[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">toupper</span>(new_oil_df[, <span class="dv">1</span>])</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Start index of selected_rows from 0</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(new_oil_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Write CSV file</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(new_oil_df, <span class="at">file =</span> <span class="st">"processed_oil_all.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display new oil dataframe head()</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(new_oil_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Country     1973    1974     1975    1976     1977     1978     1979
1          WORLD       NA      NA       NA      NA       NA       NA       NA
2    AFGHANISTAN       NA      NA       NA      NA       NA       NA       NA
3        ALBANIA       NA      NA       NA      NA       NA       NA       NA
4        ALGERIA 1096.901 1008.86 982.9973 1075.26 1151.849 1231.052 1224.167
5 AMERICAN SAMOA       NA      NA       NA      NA       NA       NA       NA
6         ANGOLA  162.000  169.00 165.0000  108.00  194.000  131.000  147.000
       1980      1981       1982       1983       1984       1985       1986
1 63987.800 60602.000 58100.1000 57929.3000 59563.4579 59156.1254 61534.9577
2     0.000     0.000     0.0000     0.0000     0.0000     0.0000     0.0000
3    44.000    44.000    64.0000    75.0000    55.0000    55.0000    55.0000
4  1105.907  1002.033   986.6301   961.2603  1014.4403  1036.0712  1072.0000
5     0.000     0.000     0.0000     0.0000     0.0000     0.0000     0.0000
6   150.000   130.000   122.0000   177.0055   208.0246   231.0001   282.0003
        1987       1988       1989       1990       1991      1992       1993
1 62101.2704 64398.7317 65524.9113 66437.1839 66338.8511 66551.970 66337.0462
2     0.0000     0.0000     0.0000     0.0000     0.0000     0.000         NA
3    54.0000    44.0000    47.0000    30.0000    19.0000    10.000    11.0000
4  1071.3205  1045.0000  1105.5863  1180.0685  1170.0000  1201.612  1310.1644
5     0.0000     0.0000     0.0000     0.0000     0.0000     0.000         NA
6   360.0002   452.0082   455.0003   475.0005   500.0002   526.320   503.9397
        1994       1995       1996         1997        1998        1999
1 68404.8092 69738.1987 71406.8033 73756.479140 74754.92657 73443.88635
2         NA         NA         NA           NA          NA          NA
3    10.0000     9.0000     9.0000     7.150392     7.48989     6.46023
4  1286.2877  1301.3699  1396.7350  1430.191781  1431.04110  1376.95890
5         NA         NA         NA           NA          NA          NA
6   491.7589   639.3123   691.0164   709.786301   732.89863   747.81342
       2000       2001       2002       2003       2004      2005      2006
1 75621.903 75764.2419 75599.8619 78497.8013 83153.5017 84672.885 85250.201
2        NA         NA         NA         NA     0.0000     0.000     0.000
3     5.716     5.6240     7.1060     6.7810     7.5800     6.985     9.072
4  1435.587  1507.4795  1623.8356  1789.8904  1856.9348  1930.027  1917.468
5        NA         NA         NA         NA     0.0000     0.000     0.000
6   745.388   739.2849   896.6363   879.0602   990.2883  1255.027  1425.537
       2007        2008         2009        2010        2011        2012
1 85474.130 86767.47017 85716.225190 87317.27823 88481.56412 90769.35776
2     0.000     0.00000     0.000000     0.00000     0.00000     0.00000
3    10.082     6.03453     5.382407    10.86677    15.56252    16.84497
4  1942.264  1954.48100  1909.823112  1880.89240  1862.56450  1875.03977
5     0.000     0.00000     0.000000     0.00000     0.00000     0.00000
6  1727.449  1960.22651  1886.364219  1918.07255  1765.13444  1796.58018
         2013        2014        2015        2016        2017         2018
1 91305.82012 93899.47441 96659.23578 97108.92000 97786.58439 100415.82470
2     0.00000     0.00000     0.00000     0.00000     0.00000      0.00000
3    17.01442    20.56921    20.21514    22.80052    17.05404     16.05469
4  1762.78932  1721.82560  1798.10490  1698.43226  1632.86953   1576.78693
5     0.00000     0.00000     0.00000     0.00000     0.00000      0.00000
6  1814.16853  1755.94544  1828.00001  1796.77775  1708.35453   1637.11644
          2019        2020        2021         2022         2023 2024
1 100161.55460 93798.40647 95682.74081 100140.08950 101820.39170   NA
2      0.00000     0.00000     0.00000      0.00000      0.00000   NA
3     18.05546    17.31386    16.15055     15.05976     14.04473   NA
4   1570.10430  1404.30674  1415.12934   1473.03068   1444.29105   NA
5      0.00000     0.00000     0.00000      0.00000      0.00000   NA
6   1488.93237  1284.13903  1150.41740   1185.25440   1174.42220   NA</code></pre>
</div>
</div>
</section>
</section>
<section id="preprocess-cars-data" class="level2">
<h2 class="anchored" data-anchor-id="preprocess-cars-data">Preprocess Cars Data</h2>
<section id="step-1-process-countries-names-remove-datarows-with-empty-strings" class="level3">
<h3 class="anchored" data-anchor-id="step-1-process-countries-names-remove-datarows-with-empty-strings">Step 1: Process Countries Names, Remove Datarows with Empty Strings (““)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new dataframe</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>new_cars_df <span class="ot">&lt;-</span> cars_raw</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert column 1 names to upper</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>new_cars_df[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">toupper</span>(new_cars_df[, <span class="dv">1</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find rows where the data in the first column is ""</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>rows_with_empty_first_column <span class="ot">&lt;-</span> <span class="fu">which</span>(new_cars_df[, <span class="dv">1</span>] <span class="sc">==</span> <span class="st">""</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find rows where the data in the first column is not ""</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>rows_to_keep <span class="ot">&lt;-</span> new_cars_df[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="st">""</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data frame to keep rows where the data in the first column is not ""</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>new_cars_df <span class="ot">&lt;-</span> new_cars_df[rows_to_keep, ]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display new cars dataframe head() </span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(new_cars_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country.Region       Cars Commercial.Vehicles      Total Change Year
1      ARGENTINA    304 783             305 942    610 725    14% 2023
2        AUSTRIA    102 291              11 900    114 191    -6% 2023
3        BELGIUM    285 159              46 944    332 103    16% 2023
4         BRAZIL  1 781 612             543 226  2 324 838    -2% 2023
5         CANADA    376 888           1 176 138  1 553 026    26% 2023
6          CHINA 26 123 757           4 037 209 30 160 966    12% 2023</code></pre>
</div>
</div>
</section>
<section id="step-2-get-unique-countries" class="level3">
<h3 class="anchored" data-anchor-id="step-2-get-unique-countries">Step 2: Get Unique Countries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values in column 1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>unique_countries <span class="ot">&lt;-</span> <span class="fu">unique</span>(new_cars_df[,<span class="dv">1</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print unique countries</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ARGENTINA"      "AUSTRIA"        "BELGIUM"        "BRAZIL"        
 [5] "CANADA"         "CHINA"          "CZECH REPUBLIC" "FINLAND"       
 [9] "FRANCE"         "GERMANY"        "HUNGARY"        "INDIA"         
[13] "INDONESIA"      "ITALY"          "JAPAN"          "KAZAKHSTAN"    
[17] "MALAYSIA"       "MOROCCO"        "MEXICO"         "POLAND"        
[21] "PORTUGAL"       "ROMANIA"        "RUSSIA"         "SLOVAKIA"      
[25] "SLOVENIA"       "SOUTH AFRICA"   "SOUTH KOREA"    "SPAIN"         
[29] "TAIWAN"         "THAILAND"       "TURKEY"         "UKRAINE"       
[33] "UNITED KINGDOM" "USA"            "UZBEKISTAN"     "OTHERS"        
[37] "SERBIA"         "EGYPT"          "IRAN"           "CZECH REP."    
[41] "UK"             "COLOMBIA"       "AUSTRALIA"      "NETHERLANDS"   
[45] "SWEDEN"         "SUPPLEMENTARY" </code></pre>
</div>
</div>
</section>
<section id="step-3-change-values-to-match-common-country-names" class="level3">
<h3 class="anchored" data-anchor-id="step-3-change-values-to-match-common-country-names">Step 3: Change values to Match Common Country Names</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change values in the first column from "CZECH REP." to "CZECH REPUBLIC"</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>new_cars_df[new_cars_df[, <span class="dv">1</span>] <span class="sc">==</span> <span class="st">"CZECH REP."</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"CZECH REPUBLIC"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values in column 1</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>unique_countries <span class="ot">&lt;-</span> <span class="fu">unique</span>(new_cars_df[,<span class="dv">1</span>])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check unique countries is correct</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ARGENTINA"      "AUSTRIA"        "BELGIUM"        "BRAZIL"        
 [5] "CANADA"         "CHINA"          "CZECH REPUBLIC" "FINLAND"       
 [9] "FRANCE"         "GERMANY"        "HUNGARY"        "INDIA"         
[13] "INDONESIA"      "ITALY"          "JAPAN"          "KAZAKHSTAN"    
[17] "MALAYSIA"       "MOROCCO"        "MEXICO"         "POLAND"        
[21] "PORTUGAL"       "ROMANIA"        "RUSSIA"         "SLOVAKIA"      
[25] "SLOVENIA"       "SOUTH AFRICA"   "SOUTH KOREA"    "SPAIN"         
[29] "TAIWAN"         "THAILAND"       "TURKEY"         "UKRAINE"       
[33] "UNITED KINGDOM" "USA"            "UZBEKISTAN"     "OTHERS"        
[37] "SERBIA"         "EGYPT"          "IRAN"           "UK"            
[41] "COLOMBIA"       "AUSTRALIA"      "NETHERLANDS"    "SWEDEN"        
[45] "SUPPLEMENTARY" </code></pre>
</div>
</div>
</section>
<section id="step-4-pivot-wider-on-year-concatenate-vertically-on-data-on-common-country-names-change-column-data-type-to-numeric" class="level3">
<h3 class="anchored" data-anchor-id="step-4-pivot-wider-on-year-concatenate-vertically-on-data-on-common-country-names-change-column-data-type-to-numeric">Step 4: Pivot Wider on Year, Concatenate Vertically on Data on Common Country Names, Change Column Data Type to Numeric</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all column headers</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>column_headers <span class="ot">&lt;-</span> <span class="fu">colnames</span>(new_cars_df)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider on Year</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>new_cars_df <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(new_cars_df, <span class="at">names_from =</span> <span class="st">"Year"</span>, <span class="at">values_from =</span> <span class="st">"Total"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Cars, Commercial.Vehicles, Change columns</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>new_cars_df <span class="ot">&lt;-</span> new_cars_df[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Change all columns to numeric except the first column, replace comma and space in numeric terms</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>new_cars_df[, <span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(new_cars_df[, <span class="sc">-</span><span class="dv">1</span>], <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[ ,]"</span>, <span class="st">""</span>, x)))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate vertically the columns where they have the same country.region name</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>new_cars_df <span class="ot">&lt;-</span> new_cars_df <span class="sc">|&gt;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Country.Region) <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename first column to Country</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(new_cars_df)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Country"</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Write CSV file</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(new_cars_df, <span class="at">file =</span> <span class="st">"processed_cars_all.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display new cars dataframe head()</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(new_cars_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 26
  Country  `2023` `2022` `2021` `2020` `2019` `2018` `2017` `2016` `2015` `2014`
  &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 ARGENTI… 6.11e5 5.37e5 4.35e5 2.57e5 3.15e5 4.67e5 4.72e5 4.73e5 5.34e5 6.17e5
2 AUSTRAL… 0      0      0      0      0      0      9.86e4 1.61e5 1.73e5 1.80e5
3 AUSTRIA  1.14e5 1.08e5 1.37e5 1.05e5 1.79e5 1.65e5 9.99e4 1.08e5 1.26e5 1.52e5
4 BELGIUM  3.32e5 2.77e5 2.61e5 2.67e5 2.86e5 3.08e5 3.79e5 3.99e5 4.09e5 5.17e5
5 BRAZIL   2.32e6 2.37e6 2.25e6 2.01e6 2.94e6 2.88e6 2.70e6 2.16e6 2.43e6 3.15e6
6 CANADA   1.55e6 1.23e6 1.12e6 1.38e6 1.92e6 2.02e6 2.20e6 2.37e6 2.28e6 2.39e6
# ℹ 15 more variables: `2013` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
#   `2009` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2006` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
#   `2004` &lt;dbl&gt;, `2003` &lt;dbl&gt;, `2002` &lt;dbl&gt;, `2001` &lt;dbl&gt;, `2000` &lt;dbl&gt;,
#   `1999` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="data-summarisation-get-common-data-from-both-cars-and-oil-data" class="level2">
<h2 class="anchored" data-anchor-id="data-summarisation-get-common-data-from-both-cars-and-oil-data">Data Summarisation: Get Common Data from both Cars and Oil Data</h2>
<section id="step-1-get-common-countries-and-years" class="level3">
<h3 class="anchored" data-anchor-id="step-1-get-common-countries-and-years">Step 1: Get Common Countries and Years</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Common Countries</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>common_countries <span class="ot">&lt;-</span> <span class="fu">intersect</span>(new_cars_df<span class="sc">$</span>Country, new_oil_df<span class="sc">$</span>Country)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(common_countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ARGENTINA"      "AUSTRALIA"      "AUSTRIA"        "BELGIUM"       
 [5] "BRAZIL"         "CANADA"         "CHINA"          "COLOMBIA"      
 [9] "EGYPT"          "FINLAND"        "FRANCE"         "GERMANY"       
[13] "HUNGARY"        "INDIA"          "INDONESIA"      "IRAN"          
[17] "ITALY"          "JAPAN"          "KAZAKHSTAN"     "MALAYSIA"      
[21] "MEXICO"         "MOROCCO"        "NETHERLANDS"    "POLAND"        
[25] "PORTUGAL"       "ROMANIA"        "RUSSIA"         "SERBIA"        
[29] "SLOVAKIA"       "SLOVENIA"       "SOUTH AFRICA"   "SOUTH KOREA"   
[33] "SPAIN"          "SWEDEN"         "TAIWAN"         "THAILAND"      
[37] "UKRAINE"        "UNITED KINGDOM" "UZBEKISTAN"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Common Years</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>common_years <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(new_cars_df)[<span class="sc">-</span><span class="dv">1</span>], <span class="fu">colnames</span>(new_oil_df)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(common_years)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2023" "2022" "2021" "2020" "2019" "2018" "2017" "2016" "2015" "2014"
[11] "2013" "2012" "2011" "2010" "2009" "2008" "2007" "2006" "2005" "2004"
[21] "2003" "2002" "2001" "2000" "1999"</code></pre>
</div>
</div>
</section>
<section id="step-2-get-common-data" class="level3">
<h3 class="anchored" data-anchor-id="step-2-get-common-data">Step 2: Get Common Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data based on common countries and common years</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>new_cars_df_filtered <span class="ot">&lt;-</span> new_cars_df <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">%in%</span> common_countries) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"Country"</span>, common_years)))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(new_cars_df_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 39 × 26
   Country `2023` `2022` `2021` `2020` `2019` `2018` `2017` `2016` `2015` `2014`
   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 ARGENT… 6.11e5 5.37e5 4.35e5 2.57e5 3.15e5 4.67e5 4.72e5 4.73e5 5.34e5 6.17e5
 2 AUSTRA… 0      0      0      0      0      0      9.86e4 1.61e5 1.73e5 1.80e5
 3 AUSTRIA 1.14e5 1.08e5 1.37e5 1.05e5 1.79e5 1.65e5 9.99e4 1.08e5 1.26e5 1.52e5
 4 BELGIUM 3.32e5 2.77e5 2.61e5 2.67e5 2.86e5 3.08e5 3.79e5 3.99e5 4.09e5 5.17e5
 5 BRAZIL  2.32e6 2.37e6 2.25e6 2.01e6 2.94e6 2.88e6 2.70e6 2.16e6 2.43e6 3.15e6
 6 CANADA  1.55e6 1.23e6 1.12e6 1.38e6 1.92e6 2.02e6 2.20e6 2.37e6 2.28e6 2.39e6
 7 CHINA   3.02e7 2.70e7 2.61e7 2.52e7 2.57e7 2.78e7 2.90e7 2.81e7 2.45e7 2.37e7
 8 COLOMB… 0      0      0      0      0      7.28e4 0      0      0      0     
 9 EGYPT   0      0      2.38e4 2.38e4 1.85e4 7.16e4 3.66e4 3.62e4 3.60e4 4.25e4
10 FINLAND 3.02e4 7.30e4 9.32e4 8.63e4 1.15e5 1.12e5 9.16e4 5.53e4 6.91e4 4.50e4
# ℹ 29 more rows
# ℹ 15 more variables: `2013` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
#   `2009` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2006` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
#   `2004` &lt;dbl&gt;, `2003` &lt;dbl&gt;, `2002` &lt;dbl&gt;, `2001` &lt;dbl&gt;, `2000` &lt;dbl&gt;,
#   `1999` &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new_oil_df_filtered <span class="ot">&lt;-</span> new_oil_df <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">%in%</span> common_countries) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"Country"</span>, common_years)))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(new_oil_df_filtered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Country       2023       2022       2021      2020       2019      2018
1 ARGENTINA  819.01880  787.22749  708.55453  656.8417  723.05932  704.8591
2 AUSTRALIA  408.30200  436.04136  460.13427  475.1732  475.30954  364.6695
3   AUSTRIA   23.10377   23.94636   24.90203   24.4670   26.44212   26.9227
4   BELGIUM   24.93928   24.60583   24.79236   23.6427   24.35280   18.8857
5    BRAZIL 4281.78103 3810.26619 3689.54981 3767.5390 3659.46014 3412.7907
6    CANADA 5763.26495 5693.53353 5537.45100 5234.6501 5477.58579 5348.1456
        2017      2016       2015       2014      2013       2012       2011
1  686.30951  705.0373  705.26304  713.04211  704.9671  720.72212  742.29839
2  336.95184  367.0326  396.46722  441.67774  425.2743  500.65341  508.29693
3   27.18665   29.3610   31.57499   30.84496   26.9820   36.15534   36.10133
4   19.60250   19.9088   21.05700   25.50090   20.9840   20.26460   20.06650
5 3356.21565 3219.3821 3170.19226 2954.47143 2697.2733 2655.85194 2687.04165
6 4946.55516 4576.8188 4493.86716 4378.22067 4056.8525 3842.11904 3583.71657
        2010      2009      2008       2007       2006      2005       2004
1  786.86206  786.1241  804.5547  802.62792  831.17963  830.3295  888.32444
2  584.96211  576.0445  569.4678  567.52612  560.69682  543.5201  573.15859
3   35.62572   27.5462   27.7143   28.04171   26.19536   25.3807   26.38027
4   21.12370   10.9045   10.7599   11.22400   11.91400    8.6910   10.68800
5 2714.30939 2554.2000 2429.4303 1895.93353 1863.85300 1756.6057 1584.54709
6 3429.99347 3308.3737 3345.1751 3492.69268 3382.95964 3202.2939 3158.52546
        2003       2002       2001       2000       1999
1  876.69726  895.37863  918.69818  862.82310  894.80706
2  618.16222  717.14611  738.77292  802.44615  616.76200
3   20.40548   21.72055   20.83014   19.68142   19.16712
4         NA         NA         NA         NA         NA
5 1548.22365 1499.03372 1336.32948 1268.05669 1129.35107
6 3003.46518 2858.15932 2727.95358 2721.54163 2603.83093</code></pre>
</div>
</div>
</section>
<section id="step-3-write-csv-out-for-filtered-data" class="level3">
<h3 class="anchored" data-anchor-id="step-3-write-csv-out-for-filtered-data">Step 3: Write CSV Out for Filtered Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write CSV file for cars</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(new_cars_df_filtered, <span class="at">file =</span> <span class="st">"processed_cars_filtered.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Write CSV file for oil</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(new_oil_df_filtered, <span class="at">file =</span> <span class="st">"processed_oil_filtered.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-get-oil-production-split-by-bric-and-non-bric" class="level3">
<h3 class="anchored" data-anchor-id="step-4-get-oil-production-split-by-bric-and-non-bric">Step 4: Get Oil Production Split by BRIC and Non-BRIC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter BRIC countries</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>bric_countries_oil <span class="ot">&lt;-</span> new_oil_df_filtered <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BRAZIL"</span>, <span class="st">"RUSSIA"</span>, <span class="st">"INDIA"</span>, <span class="st">"CHINA"</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Total BRIC countries oil production</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>total_bric_oil <span class="ot">&lt;-</span> bric_countries_oil <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(bric_countries_oil), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Include first column as BRIC name</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>total_bric_oil <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"BRIC"</span>, total_bric_oil)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter non-BRIC countries</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>non_bric_countries_oil <span class="ot">&lt;-</span> new_oil_df_filtered <span class="sc">|&gt;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BRAZIL"</span>, <span class="st">"RUSSIA"</span>, <span class="st">"INDIA"</span>, <span class="st">"CHINA"</span>))</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Total non-BRIC countries oil production</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>total_non_bric_oil <span class="ot">&lt;-</span> non_bric_countries_oil <span class="sc">|&gt;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(non_bric_countries_oil), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Include first column as non-BRIC name</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>total_non_bric_oil <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"non-BRIC"</span>, total_non_bric_oil)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind both tables</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>total_oil_grouped <span class="ot">=</span> <span class="fu">rbind</span>(total_bric_oil, total_non_bric_oil)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(total_oil_grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Country     2023     2022     2021     2020     2019     2018     2017
1     BRIC 21209.40 20822.05 20336.11 19977.71 20915.27 20489.35 20261.31
2 non-BRIC 20512.81 19906.88 19627.93 19096.64 20069.78 21263.51 20972.79
      2016     2015     2014     2013     2012     2011     2010     2009
1 20282.90 20303.09 19780.91 19296.99 18957.88 18704.24 18511.54 17665.75
2 20427.56 19798.02 19720.28 19309.64 19413.10 19993.77 20158.08 19641.60
      2008     2007     2006     2005     2004     2003     2002     2001
1 17347.22 16855.94 16394.47 16092.53 15577.90 14332.59 13386.91 12455.06
2 19896.89 20597.87 20590.74 20556.68 20939.99 20106.61 19590.73 19614.03
      2000     1999
1 11825.73 11202.34
2 19715.98 19648.39</code></pre>
</div>
</div>
</section>
</section>
<section id="step-5-get-car-production-by-bric-and-non-bric" class="level2">
<h2 class="anchored" data-anchor-id="step-5-get-car-production-by-bric-and-non-bric">Step 5: Get Car Production by BRIC and Non-BRIC</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter BRIC countries</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>bric_countries_cars <span class="ot">&lt;-</span> new_cars_df_filtered <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BRAZIL"</span>, <span class="st">"RUSSIA"</span>, <span class="st">"INDIA"</span>, <span class="st">"CHINA"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Total BRIC countries car production</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>total_bric_cars <span class="ot">&lt;-</span> bric_countries_cars <span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(bric_countries_cars), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Include first column as BRIC name</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>total_bric_cars <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"BRIC"</span>, total_bric_cars)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter non-BRIC countries</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>non_bric_countries_cars <span class="ot">&lt;-</span> new_cars_df_filtered <span class="sc">|&gt;</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BRAZIL"</span>, <span class="st">"RUSSIA"</span>, <span class="st">"INDIA"</span>, <span class="st">"CHINA"</span>))</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Total non-BRIC countries car production</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>total_non_bric_cars <span class="ot">&lt;-</span> non_bric_countries_cars <span class="sc">|&gt;</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(non_bric_countries_cars), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Include first column as non-BRIC name</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>total_non_bric_cars <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"non-BRIC"</span>, total_non_bric_cars)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind both tables</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>processed_cars_grouped <span class="ot">&lt;-</span> <span class="fu">rbind</span>(total_bric_cars, total_non_bric_cars)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(processed_cars_grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Country     2023     2022     2021     2020     2019     2018     2017
1     BRIC 39067175 35455701 34295902 32069078 34901454 37631324 38049295
2 non-BRIC 38988778 34893446 32466356 33453968 40620933 42228115 43091627
      2016     2015     2014     2013     2012     2011     2010     2009
1 36068104 32442932 32610036 31919875 29082132 27744303 26606806 20340479
2 41729816 41701514 41492992 40621220 40807675 39615773 39636791 32797669
      2008     2007     2006     2005     2004     2003     2002     2001
1 16637785 15773455 13327908 11241637 10449007  8711792  7192880  6216970
2 41893931 43160061 41491305 40607862 39322338 37459116 37200118 36650956
      2000     1999
1  5757527  5168682
2 37671031 36033065</code></pre>
</div>
</div>
<section id="step-4-write-csv-out-for-car-and-oil-data" class="level3">
<h3 class="anchored" data-anchor-id="step-4-write-csv-out-for-car-and-oil-data">Step 4: Write CSV Out for Car and Oil Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write CSV file for BRIC oil</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(total_oil_grouped, <span class="at">file =</span> <span class="st">"processed_oil_grouped.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Write CSV file for Car Production (BRIC &amp; Non BRIC)</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(processed_cars_grouped, <span class="at">file =</span> <span class="st">"processed_cars_grouped.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-5-consolidate-all-relevant-data-into-1-dataframe-for-plotting" class="level3">
<h3 class="anchored" data-anchor-id="step-5-consolidate-all-relevant-data-into-1-dataframe-for-plotting">Step 5: Consolidate all relevant data into 1 dataframe for plotting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>processed_cars_grouped <span class="ot">=</span> processed_cars_grouped <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"Cars"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>total_oil_grouped<span class="ot">=</span> total_oil_grouped <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"Oil"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>all_data_grouped <span class="ot">=</span> <span class="fu">rbind</span>(processed_cars_grouped <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"Cars"</span>), total_oil_grouped <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"Oil"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="data-visualization" class="level1">
<h1>Data Visualization</h1>
<section id="world-car-production-outpaces-global-oil-supplies" class="level2">
<h2 class="anchored" data-anchor-id="world-car-production-outpaces-global-oil-supplies">World Car Production Outpaces Global Oil Supplies</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot Oil Data for plotting</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>total_oil <span class="ot">&lt;-</span> total_oil_grouped <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(Country, Class), <span class="at">names_to =</span> <span class="st">"Year"</span>, <span class="at">values_to =</span> <span class="st">"Total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sum =</span> <span class="fu">sum</span>(Total))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot Car data for plotting</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>total_car <span class="ot">&lt;-</span> all_data_grouped <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(Country, Class), <span class="at">names_to =</span> <span class="st">"Year"</span>, <span class="at">values_to =</span> <span class="st">"Total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Class, <span class="at">values_from =</span> Total)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot using ggplot</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> total_car, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(Year), <span class="at">y =</span> Cars, <span class="at">fill =</span> Country, <span class="at">group =</span> Country), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> total_oil, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(Year), <span class="at">y =</span> Sum <span class="sc">*</span> <span class="dv">1300</span>, <span class="at">color =</span> <span class="st">'Oil Production'</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="st">"2004"</span>, <span class="st">"2009"</span>, <span class="st">"2020"</span>)), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">group=</span><span class="dv">1</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="st">"2004"</span>), <span class="at">y =</span> <span class="fl">1e+6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.8</span>,  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Production rate diverges"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="st">"2009"</span>), <span class="at">y =</span> <span class="fl">1e+6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.8</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Asian Financial Crisis"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="st">"2020"</span>), <span class="at">y =</span> <span class="fl">1e+6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.8</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Covid-19 Epidemic"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"World Car Production Outpaces Global Oil Supplies"</span>,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"By BRIC &amp; non-BRIC Countries and Year"</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Car Production"</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: EIA, OCIA"</span>) <span class="sc">+</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">unit =</span> <span class="st">"M"</span>, <span class="at">scale =</span> <span class="fl">1e-6</span>), <span class="at">expand =</span>   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1999</span>, <span class="dv">2023</span>, <span class="at">by =</span> <span class="dv">2</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1999</span>, <span class="dv">2023</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Country"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Oil Production"</span>)) <span class="sc">+</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.8</span>),</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.0</span>, <span class="st">"cm"</span>),</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.background =</span> <span class="fu">element_rect</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">'white'</span>),</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#EEEEEE"</span>),</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#EEEEEE"</span>),</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">"cm"</span>))</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data_preprocess_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="yearly-change-of-car-and-oil-production" class="level2">
<h2 class="anchored" data-anchor-id="yearly-change-of-car-and-oil-production">Yearly Change of Car and Oil Production</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot all data</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>longdata <span class="ot">=</span> all_data_grouped <span class="sc">|&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span><span class="fu">c</span>(Country, Class), <span class="at">names_to =</span> <span class="st">"Year"</span>, <span class="at">values_to =</span> <span class="st">"Total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Class, <span class="at">values_from =</span> Total) <span class="sc">|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add YoY % change to columns</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> longdata <span class="sc">|&gt;</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Country) <span class="sc">|&gt;</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Car_Change =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(Cars)) <span class="sc">/</span> <span class="fu">lag</span>(Cars, <span class="at">default =</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Oil_Change =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(Oil)) <span class="sc">/</span> <span class="fu">lag</span>(Oil, <span class="at">default =</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Country) <span class="sc">|&gt;</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(Car_Change, Oil_Change), <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)))</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate oil data</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>oil_sum <span class="ot">=</span> data <span class="sc">|&gt;</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">|&gt;</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(Oil_Change))</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot using ggplot</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Car_Change, <span class="at">group =</span> Country, <span class="at">color =</span> Country), <span class="at">linetype =</span> <span class="st">'solid'</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> oil_sum, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> total, <span class="at">color =</span> <span class="st">'Oil Change'</span>), <span class="at">group =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">'solid'</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="st">"2004"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="st">"2009"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="st">"2020"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="st">"2004"</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">24</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.8</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Production rate diverges"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="st">"2009"</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">24</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.8</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Asian Financial Crisis"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="st">"2020"</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">24</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.8</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Covid-19 Epidemic"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="st">"1999"</span>) <span class="sc">+</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="cf">function</span>(x) { x[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)] }, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"BRIC - Car Production"</span>, <span class="st">"Non-BRIC - Car Production"</span>, <span class="st">"Oil Production"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#F8766D"</span>,<span class="st">"#619CFF"</span>, <span class="st">"#000000"</span>)) <span class="sc">+</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly Change of Car and Oil Production"</span>,</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"By BRIC &amp; non-BRIC Countries and Year"</span>,</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"% Change"</span>,</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: EIA, OCIA"</span>) <span class="sc">+</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.85</span>,<span class="fl">0.85</span>),</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.0</span>, <span class="st">"cm"</span>),</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.background =</span> <span class="fu">element_rect</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">'white'</span>),</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#EEEEEE"</span>),</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#EEEEEE"</span>),</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"cm"</span>)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data_preprocess_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>